This repository has the code for reproducing the results in the **Epidemics** paper entitled *Estimating nosocomial transmission of micro-organisms in hospital settings using patient records and culture data*.

The repository tracked all the research process in the associated jupyter notebooks. Those were used to process the data, conduct parameter inference and produce the manuscript Figures. As a consequence it is not organized. In below I list what would you need to reproduce the results. The data however has individual patient information and thus is private. To have access to the data please email the corresponding authors: [Jeffrey Shaman](https://www.publichealth.columbia.edu/profile/jeffrey-shaman-phd) and [Sen Pei](https://www.publichealth.columbia.edu/profile/sen-pei).

We use an Iterated Ensemble Adjustment Kalman Filter to infer posterior parameter estimates. We developed another python package that code the iterated EAKF. To install the package run the code below.

    git clone -b numpy-version https://github.com/ChaosDonkey06/pompjax.git
    cd pompjax
    pip install .

We first present the data we used in Figure 1, the notebook associated is in [figure 1](manuscript/Fig1.ipynb). The associated Supplementary Material (SM) Figures are those presenting the data: the **Ward size distribution** ([SM Fig S1](manuscript/Fig1.ipynb)), the **Transfer matrices at the ward and building levels** ([SM Fig S2](manuscript/Fig .ipynb)), the **Hospital traffic at the building level** ([SM Fig S3](manuscript/)), the **Hospital traffic at the ward level** ([SM Fig S4]()), the **Relationship between hospitalizations and admissions** ([SM Fig S5]()) and the **Length of stay distributions at hospital and building level** ([SM Fig S6](manuscript/AverageLOSInHospital2.ipynb)).

We then study the *"parameter identifiability"* of the agent based model. I use the *""* because people mean different things with the term and study it from different perspectives. We decided to conduct inferences on simulated data and see if the method recovered the parameters. I the main text Figure 2 we present those inferences. The notebook to run the inferences on synthetic/simulated data are in (abm/). The . In the associated SM Figures we see show **Convergence plots of inference for synthetic data** ([SM Fig S7]()), and investigate the **Goodness-of-fit of posterior inference on synthetic data, Monte Carlo and statistical error analysis** ([SM Fig S8]()). Lastly we present the **Hospital-level simulation of synthetic tests and calibration** ([SM Fig S9]()). In the main Figure we conducted synthetic inferences on importation rates of $\gamma=\{25%, 50%\}$. The reviewers were concerned on the ability of the system to infer parameters on lower importation rates, so we ran more inferences on $\gamma=\{5%, 10%, 15%\}$. We present those posterior inferences in **Identifiability, parameter estimates on simulated data** ([SM Fig S10]()), and show **Convergence plots of inferences for synthetic data with low $\mathbf{\rho}$ and $\mathbf{\beta}$** ([SM Fig S11]()).

Having confidence on the *identifiability* we went and conducted inferences on the real data for the 7 pathogens. In the main text we present the parameter inferences in Figure 3 ([Fig 3](manuscript/Fig3and4.ipynb)) and Simulated with those estimates and measured calibration at the hospital level ([Fig 4](manuscript/Fig3and4.ipynb)). The associated SM Figures include first the **Marginal posterior parameter estimates for each pathogen** ([Fig S12]()) and the associated **Building-level simulation of posterior parameter estimates and calibration** ([Fig S14]()). The reviewers were concerned with our parametrization of the importation rate $\gamma$. We extended inferences diminishing $\gamma$ until $f=30%$ of the highest value we found in the literature. This sensitivity analysis is presented in **Marginal posterior parameter estimates across different importation rate** ([Fig S13]()). Additionally, as our study period covered the first COVID-19 hospitalizations peak in NYC we conducted an additional sensitivity analysis: **Schematic for sensitivity analyses ignoring weeks at the beginning of the study period** ([Fig S16]()) and **Sensitivity analyses for the beginning of the time series, and the COVID-19 period** ([Fig S17]()).
